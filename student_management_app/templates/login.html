{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="session-status">
  <div class="status-circle {% if session_exists %}session-active{% else %}session-inactive{% endif %}"></div>
  <p>{% if session_exists %}Session Active{% else %}No Session{% endif %}</p>
</div>

<div class="login-box">
  <div class="logo-section">
    <img src="{% static 'admin/img/logo.png' %}" alt="Logo" class="login-logo">
    <h2>Flor de Grace School, Inc</h2>
    <h3><b>SCHOOL MANAGEMENT SYSTEM</b></h3>
  </div>
  
  <form id="login-form" action="{% url 'doLogin' %}" method="POST">
    {% csrf_token %}
    
    <div class="input-group">
      <span for="email" class="input-label">Enter Email</span>
      <input type="email" id="email" class="form-control" placeholder="Email" name="email" required>
    </div>

    <div class="input-group">
      <span for="password" class="input-label">Enter Password</span>
      <input type="password" id="password" class="form-control" placeholder="Password" name="password" required>
    </div>

    <button type="submit" class="login-btn">Login</button>
    
    <div class="forgot-password">
      <a href="{% url 'password_reset' %}">Forgot Password?</a>
    </div>

    {% if messages %}
    <div class="messages">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('login-form');

    // Check login status on page load
    fetch('/api/check_login_status_unauthenticated/')
      .then(response => response.json())
      .then(data => {
        if (data.is_logged_in) {
          alert("You are already logged in.");
          // Redirect to home page or another suitable location
          window.location.href = '/';  // Change to the appropriate page
        }
      });

    // Optional: Prevent form submission if already logged in
    loginForm.addEventListener('submit', function(event) {
      fetch('/api/check_login_status/')
        .then(response => response.json())
        .then(data => {
          if (data.is_logged_in) {
            alert("You are already logged in. Please log out first.");
            event.preventDefault();  // Prevent the form from submitting
          }
        });
    });
  });
</script>

{% endblock %}
